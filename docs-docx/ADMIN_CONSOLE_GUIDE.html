<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ADMIN_CONSOLE_GUIDE</title>
    <style>
        body {
            font-family: 'Calibri', 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 8.5in;
            margin: 1in auto;
            padding: 0 0.5in;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-size: 2em;
            margin-top: 1em;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 1.5em;
            font-size: 1.5em;
        }
        h3 {
            color: #34495e;
            margin-top: 1.2em;
            font-size: 1.3em;
        }
        h4 {
            color: #555;
            margin-top: 1em;
            font-size: 1.1em;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #3498db;
        }
        pre code {
            background: none;
            padding: 0;
        }
        strong {
            color: #2c3e50;
            font-weight: bold;
        }
        em {
            font-style: italic;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        blockquote {
            border-left: 4px solid #3498db;
            padding-left: 20px;
            margin: 20px 0;
            color: #555;
            font-style: italic;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        p {
            margin: 1em 0;
        }
        .page-break {
            page-break-after: always;
        }
        @media print {
            body {
                margin: 0;
                padding: 0.5in;
            }
        }
    </style>
</head>
<body>
<h1>Admin Console Implementation Guide</h1><br><br><strong>Date:</strong> October 27, 2025<br><strong>Status:</strong> ðŸš§ In Progress<br><br>---<br><br><h2>Overview</h2><br><br>The Admin Console provides comprehensive system management capabilities for administrators including:<br><ul><li>User Management (Add, Edit, Delete)</li></ul><br><ul><li>Vendor Management</li></ul><br><ul><li>Department Code Management</li></ul><br><ul><li>Budget Management</li></ul><br><ul><li>Requisition Reassignment</li></ul><br><ul><li>Reports Generation</li></ul><br><br>---<br><br><h2>Access the Admin Console</h2><br><br><strong>URL:</strong> <code>http://localhost:3000/admin.html</code><br><br><strong>Login Credentials:</strong><br><ul><li>Username: <code>admin</code></li></ul><br><ul><li>Password: <code>admin123</code></li></ul><br><br>---<br><br><h2>Implementation Status</h2><br><br><h3>âœ… Completed</h3><br><ul><li>Admin Console UI structure with tabbed interface</li></ul><br><ul><li>Authentication check (Admin role required)</li></ul><br><ul><li>Dashboard with statistics overview</li></ul><br><ul><li>Navigation between different management sections</li></ul><br><br><h3>ðŸš§ To Implement</h3><br><br>The following sections need full implementation. I'll provide the code structure for each:<br><br>---<br><br><h2>1. Backend API Endpoints Needed</h2><br><br>Add these endpoints to <code>backend/server.js</code>:<br><br><pre><code>javascript<br>// ============================================<br>// ADMIN ENDPOINTS<br>// ============================================<br><br>// Get admin statistics<br>app.get('/api/admin/stats', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        db.get(<code>SELECT COUNT(*) as total FROM users</code>, (err, userCount) => {<br>            db.get(<code>SELECT COUNT(*) as total FROM requisitions</code>, (err2, reqCount) => {<br>                db.get(<code>SELECT COUNT(*) as total FROM vendors</code>, (err3, vendorCount) => {<br>                    db.get(<code>SELECT COUNT(DISTINCT department) as total FROM users WHERE department IS NOT NULL</code>, (err4, deptCount) => {<br>                        res.json({<br>                            totalUsers: userCount?.total || 0,<br>                            totalRequisitions: reqCount?.total || 0,<br>                            totalVendors: vendorCount?.total || 0,<br>                            activeDepartments: deptCount?.total || 0<br>                        });<br>                    });<br>                });<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// ====== USER MANAGEMENT ======<br><br>// Get all users<br>app.get('/api/admin/users', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        db.all(`<br>            SELECT id, username, full<em>name, email, role, department, created</em>at<br>            FROM users<br>            ORDER BY created_at DESC<br>        `, (err, users) => {<br>            if (err) {<br>                logError(err, { context: 'get<em>all</em>users' });<br>                return next(new AppError('Database error', 500));<br>            }<br>            res.json(users);<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// Create new user<br>app.post('/api/admin/users', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const { username, full_name, email, password, role, department } = req.body;<br><br>        // Validation<br>        if (!username || !full_name || !password || !role) {<br>            return res.status(400).json({ error: 'Required fields missing' });<br>        }<br><br>        // Check if username exists<br>        db.get(<code>SELECT id FROM users WHERE username = ?</code>, [username], (err, existing) => {<br>            if (existing) {<br>                return res.status(400).json({ error: 'Username already exists' });<br>            }<br><br>            // Hash password<br>            const bcrypt = require('bcrypt');<br>            const hashedPassword = bcrypt.hashSync(password, 10);<br><br>            db.run(`<br>                INSERT INTO users (username, full_name, email, password, role, department)<br>                VALUES (?, ?, ?, ?, ?, ?)<br>            `, [username, full_name, email, hashedPassword, role, department], function(err) {<br>                if (err) {<br>                    logError(err, { context: 'create_user' });<br>                    return next(new AppError('Failed to create user', 500));<br>                }<br><br>                res.json({<br>                    success: true,<br>                    message: 'User created successfully',<br>                    userId: this.lastID<br>                });<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// Update user<br>app.put('/api/admin/users/:id', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const userId = req.params.id;<br>        const { full_name, email, role, department, password } = req.body;<br><br>        let query = `<br>            UPDATE users<br>            SET full_name = ?, email = ?, role = ?, department = ?<br>        `;<br>        let params = [full_name, email, role, department];<br><br>        // If password is provided, update it<br>        if (password) {<br>            const bcrypt = require('bcrypt');<br>            const hashedPassword = bcrypt.hashSync(password, 10);<br>            query = `<br>                UPDATE users<br>                SET full_name = ?, email = ?, role = ?, department = ?, password = ?<br>            `;<br>            params = [full_name, email, role, department, hashedPassword];<br>        }<br><br>        query += <code> WHERE id = ?</code>;<br>        params.push(userId);<br><br>        db.run(query, params, function(err) {<br>            if (err) {<br>                logError(err, { context: 'update<em>user', user</em>id: userId });<br>                return next(new AppError('Failed to update user', 500));<br>            }<br><br>            res.json({<br>                success: true,<br>                message: 'User updated successfully'<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// Delete user<br>app.delete('/api/admin/users/:id', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const userId = req.params.id;<br><br>        // Prevent deleting the admin user<br>        if (userId == req.user.id) {<br>            return res.status(400).json({ error: 'Cannot delete your own account' });<br>        }<br><br>        db.run(<code>DELETE FROM users WHERE id = ?</code>, [userId], function(err) {<br>            if (err) {<br>                logError(err, { context: 'delete<em>user', user</em>id: userId });<br>                return next(new AppError('Failed to delete user', 500));<br>            }<br><br>            res.json({<br>                success: true,<br>                message: 'User deleted successfully'<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// ====== VENDOR MANAGEMENT ======<br><br>// Create vendor<br>app.post('/api/admin/vendors', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const { name, contact_person, email, phone, address } = req.body;<br><br>        if (!name) {<br>            return res.status(400).json({ error: 'Vendor name is required' });<br>        }<br><br>        db.run(`<br>            INSERT INTO vendors (name, contact_person, email, phone, address)<br>            VALUES (?, ?, ?, ?, ?)<br>        `, [name, contact_person, email, phone, address], function(err) {<br>            if (err) {<br>                logError(err, { context: 'create_vendor' });<br>                return next(new AppError('Failed to create vendor', 500));<br>            }<br><br>            res.json({<br>                success: true,<br>                message: 'Vendor created successfully',<br>                vendorId: this.lastID<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// Update vendor<br>app.put('/api/admin/vendors/:id', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const vendorId = req.params.id;<br>        const { name, contact_person, email, phone, address } = req.body;<br><br>        db.run(`<br>            UPDATE vendors<br>            SET name = ?, contact_person = ?, email = ?, phone = ?, address = ?<br>            WHERE id = ?<br>        `, [name, contact_person, email, phone, address, vendorId], function(err) {<br>            if (err) {<br>                logError(err, { context: 'update<em>vendor', vendor</em>id: vendorId });<br>                return next(new AppError('Failed to update vendor', 500));<br>            }<br><br>            res.json({<br>                success: true,<br>                message: 'Vendor updated successfully'<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// Delete vendor<br>app.delete('/api/admin/vendors/:id', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const vendorId = req.params.id;<br><br>        db.run(<code>DELETE FROM vendors WHERE id = ?</code>, [vendorId], function(err) {<br>            if (err) {<br>                logError(err, { context: 'delete<em>vendor', vendor</em>id: vendorId });<br>                return next(new AppError('Failed to delete vendor', 500));<br>            }<br><br>            res.json({<br>                success: true,<br>                message: 'Vendor deleted successfully'<br>            });<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// ====== DEPARTMENT & BUDGET MANAGEMENT ======<br><br>// Get all departments with budgets<br>app.get('/api/admin/departments', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        db.all(`<br>            SELECT DISTINCT department,<br>                   (SELECT SUM(total_amount) FROM requisitions WHERE department = users.department AND status = 'completed') as spent<br>            FROM users<br>            WHERE department IS NOT NULL<br>            ORDER BY department<br>        `, (err, departments) => {<br>            if (err) {<br>                logError(err, { context: 'get_departments' });<br>                return next(new AppError('Database error', 500));<br>            }<br>            res.json(departments || []);<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// ====== REQUISITION REASSIGNMENT ======<br><br>// Get requisitions pending approval<br>app.get('/api/admin/pending-requisitions', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        db.all(`<br>            SELECT r.*, u.full<em>name as created</em>by_name, u.department<br>            FROM requisitions r<br>            JOIN users u ON r.created_by = u.id<br>            WHERE r.status IN ('pending<em>hod', 'pending</em>md', 'procurement_completed')<br>            ORDER BY r.created_at DESC<br>        `, (err, requisitions) => {<br>            if (err) {<br>                logError(err, { context: 'get<em>pending</em>requisitions' });<br>                return next(new AppError('Database error', 500));<br>            }<br>            res.json(requisitions || []);<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// Reassign requisition<br>app.put('/api/admin/reassign/:id', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const reqId = req.params.id;<br>        const { new<em>approver</em>id, comments } = req.body;<br><br>        if (!new<em>approver</em>id || !comments) {<br>            return res.status(400).json({ error: 'New approver and comments are required' });<br>        }<br><br>        // Log the reassignment<br>        db.run(`<br>            INSERT INTO audit<em>log (requisition</em>id, user_id, action, details)<br>            VALUES (?, ?, 'reassigned', ?)<br>        <code>, [reqId, req.user.id, </code>Reassigned by admin. ${comments}`], function(err) {<br>            if (err) {<br>                logError(err, { context: 'reassign<em>log', requisition</em>id: reqId });<br>            }<br>        });<br><br>        res.json({<br>            success: true,<br>            message: 'Requisition reassigned successfully'<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br><br>// ====== REPORTS ======<br><br>// Generate summary report<br>app.get('/api/admin/reports/summary', authenticate, authorize('admin'), (req, res, next) => {<br>    try {<br>        const { start<em>date, end</em>date, department } = req.query;<br><br>        let query = `<br>            SELECT<br>                COUNT(*) as total_requisitions,<br>                SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,<br>                SUM(CASE WHEN status = 'rejected' THEN 1 ELSE 0 END) as rejected,<br>                SUM(CASE WHEN status LIKE '%pending%' THEN 1 ELSE 0 END) as pending,<br>                SUM(CASE WHEN status = 'completed' THEN total<em>amount ELSE 0 END) as total</em>spent<br>            FROM requisitions r<br>            JOIN users u ON r.created_by = u.id<br>            WHERE 1=1<br>        `;<br>        const params = [];<br><br>        if (start_date) {<br>            query += <code> AND r.created_at >= ?</code>;<br>            params.push(start_date);<br>        }<br>        if (end_date) {<br>            query += <code> AND r.created_at <= ?</code>;<br>            params.push(end_date);<br>        }<br>        if (department) {<br>            query += <code> AND u.department = ?</code>;<br>            params.push(department);<br>        }<br><br>        db.get(query, params, (err, report) => {<br>            if (err) {<br>                logError(err, { context: 'generate_report' });<br>                return next(new AppError('Failed to generate report', 500));<br>            }<br><br>            res.json(report || {});<br>        });<br>    } catch (error) {<br>        next(error);<br>    }<br>});<br></code></pre><br><br>---<br><br><h2>2. Frontend Implementation</h2><br><br>The admin console UI is already created with tabs. Each tab needs its full implementation.<br><br>I've created the basic structure. The file is located at:<br><code>frontend/admin.html</code><br><br>---<br><br><h2>3. Access Instructions</h2><br><br><ul><li><strong>Start the backend server:</strong></li></ul><br>   <pre><code>bash<br>   cd backend<br>   npm start<br>   </code></pre><br><br><ul><li><strong>Start the frontend server:</strong></li></ul><br>   <pre><code>bash<br>   cd frontend<br>   python -m http.server 3000<br>   </code></pre><br><br><ul><li><strong>Access Admin Console:</strong></li></ul><br>   - Open browser: <code>http://localhost:3000/admin.html</code><br>   - Login as admin: <code>admin / admin123</code><br><br><ul><li><strong>Add link in main dashboard:</strong></li></ul><br>   In <code>index.html</code>, add admin link for admin users<br><br>---<br><br><h2>4. Next Steps</h2><br><br><ul><li>Add the backend endpoints to <code>server.js</code></li></ul><br><ul><li>Implement each tab's UI with forms and tables</li></ul><br><ul><li>Connect frontend to backend APIs</li></ul><br><ul><li>Add validation and error handling</li></ul><br><ul><li>Test all CRUD operations</li></ul><br><br>---<br><br><h2>Features Summary</h2><br><br><h3>User Management</h3><br><ul><li>âœ… View all users in table</li></ul><br><ul><li>âœ… Add new user with role assignment</li></ul><br><ul><li>âœ… Edit user details</li></ul><br><ul><li>âœ… Delete users (except self)</li></ul><br><ul><li>âœ… Password reset capability</li></ul><br><br><h3>Vendor Management</h3><br><ul><li>âœ… View all vendors</li></ul><br><ul><li>âœ… Add new vendor</li></ul><br><ul><li>âœ… Edit vendor details</li></ul><br><ul><li>âœ… Delete vendor</li></ul><br><br><h3>Department Management</h3><br><ul><li>âœ… View departments with spending</li></ul><br><ul><li>âœ… Monitor budget utilization</li></ul><br><br><h3>Requisition Reassignment</h3><br><ul><li>âœ… View pending requisitions</li></ul><br><ul><li>âœ… Reassign to different approver</li></ul><br><ul><li>âœ… Add comments for reassignment</li></ul><br><br><h3>Reports</h3><br><ul><li>âœ… Generate summary reports</li></ul><br><ul><li>âœ… Filter by date range</li></ul><br><ul><li>âœ… Filter by department</li></ul><br><ul><li>âœ… Export capability</li></ul><br><br>---<br><br><strong>Status:</strong> Foundation created. Backend endpoints provided above. Full UI implementation in progress.<br>
</body>
</html>