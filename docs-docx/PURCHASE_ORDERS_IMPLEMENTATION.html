<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PURCHASE_ORDERS_IMPLEMENTATION</title>
    <style>
        body {
            font-family: 'Calibri', 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 8.5in;
            margin: 1in auto;
            padding: 0 0.5in;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-size: 2em;
            margin-top: 1em;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 1.5em;
            font-size: 1.5em;
        }
        h3 {
            color: #34495e;
            margin-top: 1.2em;
            font-size: 1.3em;
        }
        h4 {
            color: #555;
            margin-top: 1em;
            font-size: 1.1em;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #3498db;
        }
        pre code {
            background: none;
            padding: 0;
        }
        strong {
            color: #2c3e50;
            font-weight: bold;
        }
        em {
            font-style: italic;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        blockquote {
            border-left: 4px solid #3498db;
            padding-left: 20px;
            margin: 20px 0;
            color: #555;
            font-style: italic;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        p {
            margin: 1em 0;
        }
        .page-break {
            page-break-after: always;
        }
        @media print {
            body {
                margin: 0;
                padding: 0.5in;
            }
        }
    </style>
</head>
<body>
<h1>Purchase Orders Implementation - Complete</h1><br><br><h2>Date: October 30, 2025</h2><br><br>---<br><br><h2>Overview</h2><br><br>Implemented a comprehensive Purchase Order system with role-based access control and PDF generation capabilities. POs are automatically created when MD approves requisitions and are accessible through a dedicated "Purchase Orders" section in the sidebar.<br><br>---<br><br><h2>Features Implemented</h2><br><br><h3>1. Automatic PO Generation âœ…</h3><br><ul><li><strong>Trigger:</strong> When MD approves a requisition</li></ul><br><ul><li><strong>PO Number Format:</strong> <code>PO-YearMonth-ReqNumber</code></li></ul><br>  - Example: <code>PO-202510-KSB-IT-JB-20251030123456</code><br><ul><li><strong>Storage:</strong> Saved in <code>purchase_orders</code> table</li></ul><br><ul><li><strong>Audit Trail:</strong> Logged in <code>audit_log</code> table</li></ul><br><br><h3>2. Role-Based Access Control âœ…</h3><br><br>| Role | Access Level | Can See |<br>|------|-------------|---------|<br>| <strong>Procurement</strong> | All POs | All Purchase Orders (for download/distribution) |<br>| <strong>Finance</strong> | All POs | All Purchase Orders (financial oversight) |<br>| <strong>MD</strong> | All POs | All Purchase Orders (executive view) |<br>| <strong>HOD</strong> | Filtered POs | Only POs from requisitions they approved |<br>| <strong>Initiator</strong> | Own POs | Only POs from their own requisitions |<br>| <strong>Admin</strong> | All POs | All Purchase Orders (full access) |<br><br><h3>3. PDF Generation âœ…</h3><br><ul><li><strong>Professional Format:</strong> Company header, vendor details, items table</li></ul><br><ul><li><strong>Content:</strong></li></ul><br>  - PO Number and Date<br>  - Company Information (From)<br>  - Vendor Information (To)<br>  - Requisition Details<br>  - Items with quantities, unit prices, totals<br>  - Grand Total<br>  - Complete Approval Chain (HOD â†’ Procurement â†’ Finance â†’ MD)<br>  - Generation timestamp<br><ul><li><strong>Security:</strong> Role-based access validation before PDF generation</li></ul><br><ul><li><strong>Filename:</strong> <code>PO<em>{PO</em>NUMBER}.pdf</code></li></ul><br><br><h3>4. Purchase Orders View âœ…</h3><br><ul><li><strong>Location:</strong> Sidebar â†’ "ğŸ“„ Purchase Orders" menu item</li></ul><br><ul><li><strong>Display:</strong></li></ul><br>  - Table with PO Number, Requisition, Description, Department, Amount, Date<br>  - Download PDF button for each PO<br>  - Responsive design<br>  - Empty state with helpful messages<br><ul><li><strong>Functionality:</strong></li></ul><br>  - One-click PDF download<br>  - Automatic filename generation<br>  - Error handling with user-friendly messages<br><br>---<br><br><h2>Backend Implementation</h2><br><br><h3>API Endpoints</h3><br><br><h4>1. Get All Purchase Orders</h4><br><pre><code>http<br>GET /api/purchase-orders<br>Authorization: Bearer <token><br></code></pre><br><br><strong>Role-Based Filtering:</strong><br><ul><li><strong>Initiators:</strong> Returns only POs from their requisitions (<code>created_by = user.id</code>)</li></ul><br><ul><li><strong>HODs:</strong> Returns only POs they approved (<code>hod<em>approved</em>by = user.id</code>)</li></ul><br><ul><li><strong>Procurement/Finance/MD/Admin:</strong> Returns all POs</li></ul><br><br><strong>Response:</strong><br><pre><code>json<br>[<br>  {<br>    "id": 1,<br>    "po_number": "PO-202510-KSB-IT-JB-20251030123456",<br>    "requisition_id": 5,<br>    "req_number": "KSB-IT-JB-20251030123456",<br>    "description": "Office supplies for IT Department",<br>    "department": "IT",<br>    "total_amount": 27500.00,<br>    "created_by": 1,<br>    "created<em>by</em>name": "John Banda",<br>    "approved<em>by</em>name": "David Mulenga",<br>    "created_at": "2025-10-30T10:30:00.000Z"<br>  }<br>]<br></code></pre><br><br><h4>2. Download PO as PDF</h4><br><pre><code>http<br>GET /api/purchase-orders/:id/pdf<br>Authorization: Bearer <token><br></code></pre><br><br><strong>Access Control:</strong><br><ul><li>Validates user has permission to view this PO</li></ul><br><ul><li>Returns 403 if access denied</li></ul><br><br><strong>Response:</strong><br><ul><li><code>Content-Type: application/pdf</code></li></ul><br><ul><li><code>Content-Disposition: attachment; filename="PO<em>{PO</em>NUMBER}.pdf"</code></li></ul><br><ul><li>Binary PDF stream</li></ul><br><br><strong>File Location:</strong> <code>backend/server.js</code> (Lines 1072-1321)<br><br>---<br><br><h2>Frontend Implementation</h2><br><br><h3>Components</h3><br><br><h4>1. Purchase Orders View</h4><br><strong>Location:</strong> <code>frontend/app.js</code> (Lines 3044-3145)<br><br><strong>Features:</strong><br><ul><li>Loads POs on component mount</li></ul><br><ul><li>Displays table with sortable columns</li></ul><br><ul><li>Download button for each PO</li></ul><br><ul><li>Loading state</li></ul><br><ul><li>Empty state with role-specific messages</li></ul><br><br><h4>2. Sidebar Menu Item</h4><br><strong>Location:</strong> <code>frontend/app.js</code> (Line 982)<br><br><strong>Configuration:</strong><br><pre><code>javascript<br>{<br>  id: 'purchase-orders',<br>  label: 'Purchase Orders',<br>  icon: 'ğŸ“„',<br>  show: ['initiator', 'hod', 'procurement', 'finance', 'md', 'admin'].includes(user.role)<br>}<br></code></pre><br><br><h3>API Integration</h3><br><br><strong>Location:</strong> <code>frontend/app.js</code> (Lines 206-217)<br><br><pre><code>javascript<br>// Get all POs (filtered by backend based on role)<br>getPurchaseOrders: async () => {<br>  const res = await fetchWithAuth(<code>${API_URL}/purchase-orders</code>);<br>  if (!res.ok) throw new Error('Failed to fetch purchase orders');<br>  return res.json();<br>},<br><br>// Download PO PDF<br>downloadPOPDF: async (poId) => {<br>  const res = await fetchWithAuth(<code>${API_URL}/purchase-orders/${poId}/pdf</code>);<br>  if (!res.ok) throw new Error('Failed to download PO PDF');<br>  return res.blob();<br>}<br></code></pre><br><br>---<br><br><h2>PDF Format Details</h2><br><br><h3>Document Structure</h3><br><br><pre><code><br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                  PURCHASE ORDER                         â”‚<br>â”‚              PO Number: PO-202510-...                   â”‚<br>â”‚              Date: October 30, 2025                     â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  From:                          To:                     â”‚<br>â”‚  Kabwe Sugar Brokerage Ltd      Vendor Name            â”‚<br>â”‚  P.O. Box 123, Kabwe            vendor@email.com        â”‚<br>â”‚  Zambia                         +260 123 456            â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  Requisition Details                                    â”‚<br>â”‚  Requisition #: KSB-IT-JB-...                          â”‚<br>â”‚  Description: Office supplies...                        â”‚<br>â”‚  Department: IT                                         â”‚<br>â”‚  Delivery Location: IT Office, 3rd Floor               â”‚<br>â”‚  Required Date: November 15, 2025                      â”‚<br>â”‚  Urgency: High                                         â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  Items                                                  â”‚<br>â”‚  Item                Qty  Unit Price      Total        â”‚<br>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<br>â”‚  Laptops - Dell      5    ZMW 5,500.00   ZMW 27,500  â”‚<br>â”‚  Specs: i7, 16GB RAM, 512GB SSD                       â”‚<br>â”‚                                                         â”‚<br>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<br>â”‚                Grand Total:              ZMW 27,500.00 â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  Approval Chain                                         â”‚<br>â”‚  Requested by: John Banda                              â”‚<br>â”‚  HOD Approved by: Mary Mwanza                          â”‚<br>â”‚  Procurement by: James Phiri                           â”‚<br>â”‚  Finance Approved by: Sarah Banda                      â”‚<br>â”‚  MD Approved by: David Mulenga                         â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  This is a computer-generated document.                â”‚<br>â”‚  Generated on: October 30, 2025 10:30 AM              â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre><br><br><h3>PDF Styling</h3><br><ul><li><strong>Font:</strong> Helvetica (standard PDF font)</li></ul><br><ul><li><strong>Page Size:</strong> Letter (8.5" x 11")</li></ul><br><ul><li><strong>Margins:</strong> 50 points all sides</li></ul><br><ul><li><strong>Colors:</strong> Black text, gray for secondary info</li></ul><br><ul><li><strong>Layout:</strong> Professional business document format</li></ul><br><br>---<br><br><h2>Database Schema</h2><br><br><h3>purchase_orders Table</h3><br><br><pre><code>sql<br>CREATE TABLE purchase_orders (<br>    id INTEGER PRIMARY KEY AUTOINCREMENT,<br>    po_number TEXT UNIQUE NOT NULL,<br>    requisition_id INTEGER NOT NULL,<br>    total_amount REAL DEFAULT 0,<br>    status TEXT DEFAULT 'active',<br>    issued<em>to</em>vendor TEXT,<br>    delivery_date DATE,<br>    terms_conditions TEXT,<br>    notes TEXT,<br>    generated_by INTEGER NOT NULL,<br>    created<em>at DATETIME DEFAULT CURRENT</em>TIMESTAMP,<br>    updated<em>at DATETIME DEFAULT CURRENT</em>TIMESTAMP,<br>    FOREIGN KEY (requisition_id) REFERENCES requisitions(id),<br>    FOREIGN KEY (generated_by) REFERENCES users(id)<br>)<br></code></pre><br><br>---<br><br><h2>Complete Workflow</h2><br><br><h3>Requisition to PO Flow</h3><br><br><pre><code><br><ul><li>Initiator: Create requisition</li></ul><br>   â†“<br><ul><li>HOD: Approve requisition</li></ul><br>   â†“<br><ul><li>Procurement: Add vendors & pricing</li></ul><br>   â†“<br><ul><li>Finance: Approve budget</li></ul><br>   â†“<br><ul><li>MD: Final approval</li></ul><br>   â†“<br><ul><li>SYSTEM: Auto-generate PO âœ… NEW</li></ul><br>   â†“<br><ul><li>Users: View & Download PO âœ… NEW</li></ul><br></code></pre><br><br><h3>PO Number Generation</h3><br><br><strong>Format:</strong> <code>PO-{YearMonth}-{ReqNumber}</code><br><br><strong>Example:</strong><br><ul><li>Requisition: <code>KSB-IT-JB-20251030123456</code></li></ul><br><ul><li>PO Number: <code>PO-202510-KSB-IT-JB-20251030123456</code></li></ul><br><br><strong>Logic:</strong><br><pre><code>javascript<br>const now = new Date();<br>const yearMonth = <code>${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}</code>;<br>const poNumber = <code>PO-${yearMonth}-${req.req_number}</code>;<br></code></pre><br><br>---<br><br><h2>User Experience</h2><br><br><h3>Procurement Role</h3><br><strong>Access:</strong> All Purchase Orders<br><br><strong>Use Case:</strong><br><ul><li>Navigate to "Purchase Orders" in sidebar</li></ul><br><ul><li>See complete list of all POs</li></ul><br><ul><li>Download any PO as PDF</li></ul><br><ul><li>Distribute POs to vendors</li></ul><br><br><strong>Why:</strong> Procurement needs access to all POs to manage vendor relationships and order fulfillment.<br><br><h3>Finance Role</h3><br><strong>Access:</strong> All Purchase Orders<br><br><strong>Use Case:</strong><br><ul><li>Navigate to "Purchase Orders" in sidebar</li></ul><br><ul><li>See all POs for financial oversight</li></ul><br><ul><li>Download POs for records</li></ul><br><ul><li>Verify payment amounts</li></ul><br><br><strong>Why:</strong> Finance needs visibility into all POs for budget tracking and payment processing.<br><br><h3>MD Role</h3><br><strong>Access:</strong> All Purchase Orders<br><br><strong>Use Case:</strong><br><ul><li>Navigate to "Purchase Orders" in sidebar</li></ul><br><ul><li>Review all POs issued</li></ul><br><ul><li>Download for executive records</li></ul><br><ul><li>Track organizational spending</li></ul><br><br><strong>Why:</strong> MD approved these requisitions and needs visibility into the resulting POs.<br><br><h3>HOD Role</h3><br><strong>Access:</strong> POs They Approved<br><br><strong>Use Case:</strong><br><ul><li>Navigate to "Purchase Orders" in sidebar</li></ul><br><ul><li>See POs from requisitions they approved</li></ul><br><ul><li>Download for department records</li></ul><br><ul><li>Track department spending</li></ul><br><br><strong>Why:</strong> HODs need to see outcomes of requisitions they approved from their department.<br><br><h3>Initiator Role</h3><br><strong>Access:</strong> Own POs Only<br><br><strong>Use Case:</strong><br><ul><li>Navigate to "Purchase Orders" in sidebar</li></ul><br><ul><li>See POs from their requisitions</li></ul><br><ul><li>Download for reference</li></ul><br><ul><li>Confirm order details</li></ul><br><br><strong>Why:</strong> Initiators need to see if their requisitions resulted in POs and track order status.<br><br>---<br><br><h2>Testing Instructions</h2><br><br><h3>Test 1: Complete Flow End-to-End</h3><br><br><strong>Step 1: Create and Approve Requisition</strong><br><pre><code><br><ul><li>Login as initiator (john.banda)</li></ul><br><ul><li>Create requisition</li></ul><br><ul><li>Submit for approval</li></ul><br><ul><li>Logout</li></ul><br><br><ul><li>Login as HOD (mary.mwanza)</li></ul><br><ul><li>Approve requisition</li></ul><br><ul><li>Logout</li></ul><br><br><ul><li>Login as Procurement (james.phiri)</li></ul><br><ul><li>Add vendor and pricing</li></ul><br><ul><li>Submit to Finance</li></ul><br><ul><li>Logout</li></ul><br><br><ul><li>Login as Finance (sarah.banda)</li></ul><br><ul><li>Approve requisition</li></ul><br><ul><li>Logout</li></ul><br><br><ul><li>Login as MD (david.mulenga)</li></ul><br><ul><li>Approve requisition</li></ul><br><ul><li>Verify "PO generated" message appears</li></ul><br></code></pre><br><br><strong>Step 2: View PO (Procurement)</strong><br><pre><code><br><ul><li>Still logged in as MD (or login as procurement)</li></ul><br><ul><li>Click "ğŸ“„ Purchase Orders" in sidebar</li></ul><br><ul><li>Should see newly created PO in table</li></ul><br><ul><li>PO Number should be in format: PO-202510-...</li></ul><br><ul><li>Click "â¬‡ï¸ Download PDF"</li></ul><br><ul><li>PDF should download with correct filename</li></ul><br><ul><li>Open PDF and verify all details are correct</li></ul><br></code></pre><br><br><strong>Step 3: Test Role-Based Access</strong><br><br><strong>Initiator Access:</strong><br><pre><code><br><ul><li>Logout and login as john.banda (initiator)</li></ul><br><ul><li>Click "Purchase Orders" in sidebar</li></ul><br><ul><li>Should see ONLY POs from their own requisitions</li></ul><br><ul><li>Download PDF - should work</li></ul><br></code></pre><br><br><strong>HOD Access:</strong><br><pre><code><br><ul><li>Logout and login as mary.mwanza (HOD)</li></ul><br><ul><li>Click "Purchase Orders"</li></ul><br><ul><li>Should see ONLY POs they approved as HOD</li></ul><br><ul><li>Download PDF - should work</li></ul><br></code></pre><br><br><strong>Finance Access:</strong><br><pre><code><br><ul><li>Logout and login as sarah.banda (finance)</li></ul><br><ul><li>Click "Purchase Orders"</li></ul><br><ul><li>Should see ALL POs</li></ul><br><ul><li>Download any PDF - should work</li></ul><br></code></pre><br><br>---<br><br><h2>Security Features</h2><br><br><h3>1. Authentication Required</h3><br><ul><li>All endpoints require valid JWT token</li></ul><br><ul><li>Unauthorized users redirected to login</li></ul><br><br><h3>2. Role-Based Filtering</h3><br><ul><li>Backend filters POs based on user role</li></ul><br><ul><li>Frontend cannot bypass these restrictions</li></ul><br><br><h3>3. PDF Access Control</h3><br><ul><li>Validates user permission before generating PDF</li></ul><br><ul><li>Returns 403 Forbidden if access denied</li></ul><br><ul><li>Checks:</li></ul><br>  - Admin: Always allowed<br>  - MD/Finance/Procurement: Always allowed<br>  - Initiator: Only if they created the requisition<br>  - HOD: Only if they approved the requisition<br><br><h3>4. Audit Logging</h3><br><ul><li>Every PDF download is logged in <code>audit_log</code></li></ul><br><ul><li>Tracks who downloaded which PO and when</li></ul><br><br>---<br><br><h2>Error Handling</h2><br><br><h3>Frontend</h3><br><ul><li>Loading states while fetching data</li></ul><br><ul><li>Error messages for failed API calls</li></ul><br><ul><li>Graceful fallbacks for empty states</li></ul><br><ul><li>User-friendly error alerts</li></ul><br><br><h3>Backend</h3><br><ul><li>Try-catch blocks around all operations</li></ul><br><ul><li>Detailed error logging</li></ul><br><ul><li>Proper HTTP status codes</li></ul><br><ul><li>Descriptive error messages</li></ul><br><br>---<br><br><h2>Files Modified</h2><br><br><h3>Backend</h3><br><ul><li><strong>server.js</strong> (Lines 1072-1321)</li></ul><br>   - Added <code>GET /api/purchase-orders</code> endpoint<br>   - Added <code>GET /api/purchase-orders/:id/pdf</code> endpoint<br>   - Role-based filtering logic<br>   - PDF generation with PDFKit<br><br><h3>Frontend</h3><br><ul><li><strong>app.js</strong> (Multiple locations)</li></ul><br>   - Added PO API methods (Lines 206-217)<br>   - Added PurchaseOrders component (Lines 3044-3145)<br>   - Added sidebar menu item (Line 982)<br>   - Added view routing (Line 896)<br><br>---<br><br><h2>Dependencies</h2><br><br><h3>Backend</h3><br><ul><li><strong>pdfkit:</strong> For PDF generation (already installed)</li></ul><br><ul><li><strong>better-sqlite3:</strong> For database queries (already installed)</li></ul><br><br><h3>Frontend</h3><br><ul><li>No new dependencies required</li></ul><br><ul><li>Uses existing React and fetch API</li></ul><br><br>---<br><br><h2>Known Limitations</h2><br><br><ul><li><strong>Single Vendor Per PO:</strong></li></ul><br>   - Currently one PO per requisition<br>   - All items go to same vendor (first item's vendor)<br>   - Future: Split POs by vendor if needed<br><br><ul><li><strong>PDF Customization:</strong></li></ul><br>   - Company details hardcoded<br>   - Logo not included<br>   - Future: Add company logo and customizable header<br><br><ul><li><strong>PO Status:</strong></li></ul><br>   - All POs created with status 'active'<br>   - No workflow for PO modifications or cancellations<br>   - Future: Add PO lifecycle management<br><br>---<br><br><h2>Future Enhancements</h2><br><br><ul><li><strong>PO Status Management:</strong></li></ul><br>   - Mark POs as: Pending, Sent to Vendor, Acknowledged, Fulfilled, Cancelled<br>   - Track PO lifecycle<br><br><ul><li><strong>Vendor Acknowledgment:</strong></li></ul><br>   - Email PO to vendor automatically<br>   - Vendor portal to acknowledge receipt<br>   - Track vendor response<br><br><ul><li><strong>Delivery Tracking:</strong></li></ul><br>   - Mark items as received<br>   - Partial deliveries<br>   - Match deliveries to POs<br><br><ul><li><strong>PO Amendments:</strong></li></ul><br>   - Allow modifications to POs<br>   - Version tracking<br>   - Approval required for changes<br><br><ul><li><strong>Multiple Vendors:</strong></li></ul><br>   - Split requisitions into multiple POs<br>   - One PO per vendor<br>   - Cross-reference requisition<br><br><ul><li><strong>Email Integration:</strong></li></ul><br>   - Auto-email PO to procurement on generation<br>   - Email PO to vendor<br>   - CC relevant stakeholders<br><br><ul><li><strong>Company Branding:</strong></li></ul><br>   - Upload company logo<br>   - Customizable company details<br>   - Template selection<br><br><ul><li><strong>PO Templates:</strong></li></ul><br>   - Different templates for different types<br>   - International vs Domestic<br>   - Services vs Goods<br><br>---<br><br><h2>Troubleshooting</h2><br><br><h3>Issue: "No Purchase Orders Found"</h3><br><br><strong>Possible Causes:</strong><br><ul><li>No requisitions have been approved by MD yet</li></ul><br><ul><li>User doesn't have access to existing POs (role-based)</li></ul><br><br><strong>Solution:</strong><br><ul><li>Complete a requisition through full workflow to MD approval</li></ul><br><ul><li>Check that requisition status is 'completed'</li></ul><br><ul><li>Verify PO was created in database:</li></ul><br>   <pre><code>sql<br>   SELECT * FROM purchase_orders;<br>   </code></pre><br><br><h3>Issue: PDF Download Fails</h3><br><br><strong>Possible Causes:</strong><br><ul><li>PDF generation error on backend</li></ul><br><ul><li>Missing vendor information</li></ul><br><ul><li>Network error</li></ul><br><br><strong>Solution:</strong><br><ul><li>Check backend logs for errors</li></ul><br><ul><li>Verify requisition has complete data</li></ul><br><ul><li>Check browser console for errors</li></ul><br><ul><li>Try different PO</li></ul><br><br><h3>Issue: Access Denied (403)</h3><br><br><strong>Possible Causes:</strong><br><ul><li>User doesn't have permission for that PO</li></ul><br><ul><li>Role not recognized</li></ul><br><br><strong>Solution:</strong><br><ul><li>Verify user role is correct</li></ul><br><ul><li>Check PO ownership/approval chain</li></ul><br><ul><li>Confirm backend filtering logic</li></ul><br><br>---<br><br><h2>Summary</h2><br><br>âœ… <strong>Complete PO System Implemented!</strong><br><br><strong>Features:</strong><br><ul><li>Automatic PO generation on MD approval</li></ul><br><ul><li>Role-based access control</li></ul><br><ul><li>Professional PDF generation</li></ul><br><ul><li>Dedicated Purchase Orders view</li></ul><br><ul><li>Download functionality</li></ul><br><ul><li>Complete audit trail</li></ul><br><br><strong>Access:</strong><br><ul><li>Procurement: All POs</li></ul><br><ul><li>Finance: All POs</li></ul><br><ul><li>MD: All POs</li></ul><br><ul><li>HOD: POs they approved</li></ul><br><ul><li>Initiator: Own POs only</li></ul><br><ul><li>Admin: All POs</li></ul><br><br><strong>Location:</strong> Sidebar â†’ "ğŸ“„ Purchase Orders"<br><br><strong>PDF Format:</strong> Professional business document with full details and approval chain<br><br>---<br><br><strong>Implementation Date:</strong> October 30, 2025<br><strong>Status:</strong> âœ… Complete and Tested<br><strong>Backend:</strong> Ready<br><strong>Frontend:</strong> Ready<br><strong>Database:</strong> Updated<br>
</body>
</html>